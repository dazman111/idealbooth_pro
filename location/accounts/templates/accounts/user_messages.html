{% extends "base.html" %}
{% load i18n %}
{% block title %}Messagerie interne{% endblock %}

{% block content %}
<div class="container mx-auto py-8">

    <h1 class="text-3xl font-bold mb-6 text-gray-800">{% trans "Messagerie interne" %}</h1>

    <!-- Message de succès -->
    {% if success %}
        <div class="mb-4 p-4 bg-green-100 border border-green-300 text-green-800 rounded">
            {% trans "Message envoyé avec succès à l’administrateur." %}
        </div>
    {% endif %}

    <!-- Liste des messages -->
    <div class="space-y-4 mb-6">
        {% for message in messages_list %}
            <div class="p-4 rounded shadow-sm
                        {% if message.sender == request.user %}
                            bg-blue-50 border border-blue-200
                        {% else %}
                            bg-gray-50 border border-gray-200
                        {% endif %}">
                <div class="flex justify-between items-center">
                    <strong class="text-gray-800">{{ message.subject }}</strong>
                    <span class="text-xs text-gray-500">{{ message.created_at|date:"d/m/Y H:i" }}</span>
                </div>
                <p class="mt-2 text-gray-700">{{ message.body }}</p>
                <div class="mt-1 text-xs text-gray-500">
                    {% trans "De" %} : {{ message.sender.username }} → {% trans "À" %} : {{ message.recipient.username }}
                </div>
            </div>
        {% empty %}
            <p class="text-gray-500">{% trans "Aucun message." %}</p>
        {% endfor %}
    </div>

    <!-- Formulaire pour envoyer un message à l'admin -->
    <div class="bg-white p-6 rounded shadow border">
        <form method="post" class="space-y-4">
            {% csrf_token %}
            <div>
                <label for="subject" class="block mb-1 font-semibold text-gray-700">{% trans "Sujet" %}</label>
                <input type="text" name="subject" id="subject"
                       class="w-full border border-gray-300 rounded p-2 focus:outline-none focus:ring-2 focus:ring-black"
                       required>
            </div>

            <div>
                <label for="body" class="block mb-1 font-semibold text-gray-700">{% trans "Message" %}</label>
                <textarea name="body" id="body" rows="4"
                          class="w-full border border-gray-300 rounded p-2 focus:outline-none focus:ring-2 focus:ring-black"
                          required></textarea>
            </div>

            <button type="submit"
                    class="bg-black hover:bg-gray-800 text-white font-semibold px-5 py-2 rounded shadow transition-all duration-200">
                {% trans "Envoyer à l’administrateur" %}
            </button>
        </form>
    </div>

</div>
{% endblock %}
