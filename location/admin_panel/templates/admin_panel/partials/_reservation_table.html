{% comment %}
    Ce template est utilis√© pour rendre le tableau des r√©servations.
    Il est inclus dans 'admin_dashboard.html' et 'manage_reservations.html' pour l'affichage initial
    et est re-rendu via AJAX apr√®s application des filtres ou mise √† jour du statut.
{% endcomment %}

{% if reservations %}
<div class="overflow-x-auto rounded-lg shadow-md">
    <table class="min-w-full bg-white text-sm text-left text-gray-700">
        <thead class="bg-gray-100 text-xs uppercase text-gray-600">
            <tr>
                <th>#</th> <!-- Colonne num√©ro -->
                <th scope="col" class="px-6 py-3">Utilisateur</th>
                <th scope="col" class="px-6 py-3">Photobooth</th>
                <th scope="col" class="px-6 py-3">Date</th>
                <th scope="col" class="px-6 py-3">Statut</th>
                <th scope="col" class="px-6 py-3">Paiement</th>
                <th scope="col" class="px-6 py-3 text-center">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for reservation in reservations %}
            <tr class="border-b hover:bg-gray-50 transition">
                <td>{{ forloop.revcounter }}</td>  <!-- compte √† rebours, 37, 36, ..., 1 -->
                <td class="px-6 py-4 whitespace-nowrap font-medium">
                    <!-- Nom et pr√©nom -->
                    {{ reservation.user.first_name }} {{ reservation.user.last_name }}
                    <!-- Email en petit -->
                    <div class="text-xs text-gray-500">{{ reservation.user.email }}</div>
                    <!-- ID de l'utilisateur -->
                    <div class="text-xs text-gray-400">ID: {{ reservation.user.id }}</div>
                </td>

                <td class="px-6 py-4 whitespace-nowrap">
                    {{ reservation.photobooth.name }}
                </td>

                <td class="px-6 py-4 whitespace-nowrap">
                    {{ reservation.start_date|date:"d/m/Y" }} - {{ reservation.end_date|date:"d/m/Y" }}
                </td>

                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="py-1 px-3 rounded-full text-xs font-medium
                        {% if reservation.status == 'pending' %}
                            bg-yellow-200 text-yellow-800
                        {% elif reservation.status == 'confirmed' %}
                            bg-green-200 text-green-800
                        {% elif reservation.status == 'cancelled' %}
                            bg-red-200 text-red-800
                        {% endif %}">
                        {{ reservation.get_status_display }}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    {% if reservation.invoice %}
                        <div>
                            {% if reservation.invoice.payment_status == 'paid' %}
                                <span class="text-green-600 font-semibold">Pay√©</span>
                                {% if reservation.invoice.payment_date %}
                                    <div class="text-xs text-gray-500">Le {{ reservation.invoice.payment_date|date:"d/m/Y H:i" }}</div>
                                {% endif %}
                            {% else %}
                                <span class="text-yellow-600 font-semibold">En attente</span>
                            {% endif %}
                        </div>
                    {% else %}
                        <span class="text-gray-500">Aucune facture</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center space-x-1">
                    <!-- D√©tails -->
                    <button
  type="button"
  class="action-btn inline-flex items-center justify-center w-8 h-8 text-blue-600 hover:bg-blue-100 rounded-full transition"
  data-id="{{ reservation.id }}"
  data-action="details"
  title="D√©tails"
>
  üîç
</button>

                    <!-- Confirmer -->
                    {% if reservation.status == 'pending' %}
                        <button class="action-btn inline-flex items-center justify-center w-8 h-8 text-green-600 hover:bg-green-100 rounded-full transition" data-id="{{ reservation.id }}" data-action="confirm" title="Confirmer">
                            ‚úÖ
                        </button>
                    {% endif %}

                    <!-- Facture (visible si confirm√©e) -->
                    {% if reservation.status == 'confirmed' %}
                    <a href="{% url 'admin_panel:generate_invoice' reservation.id %}" target="_blank" class="action-btn inline-flex items-center justify-center w-8 h-8 text-indigo-600 hover:bg-indigo-100 rounded-full transition" data-id="{{ reservation.id }}" data-action="invoice" title="Facture">
                        üìÑ
                    </a>
                    {% endif %}

                    <!-- Marquer comme pay√© (visible si facture existe, n'est pas pay√©e et r√©servation non annul√©e) -->
                    {% if reservation.invoice and reservation.invoice.payment_status != 'paid' and reservation.status != 'cancelled' %}
                    <button class="action-btn inline-flex items-center justify-center w-8 h-8 text-orange-600 hover:bg-orange-100 rounded-full transition" data-id="{{ reservation.id }}" data-action="mark_paid" title="Marquer comme pay√©">
                        üí∞
                    </button>
                    {% endif %}

                    <!-- Annuler (visible si non d√©j√† annul√©e) -->
                    {% if reservation.status != 'cancelled' %}
                    <button class="action-btn inline-flex items-center justify-center w-8 h-8 text-red-600 hover:bg-red-100 rounded-full transition" data-id="{{ reservation.id }}" data-action="cancel" title="Annuler">
                        ‚ùå
                    </button>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="px-6 py-4 text-center text-gray-500">Aucune r√©servation trouv√©e.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
    <div class="text-center text-gray-500">Aucune r√©servation trouv√©e.</div>
{% endif %}
